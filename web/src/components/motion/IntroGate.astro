---
const {
  title = "Daniel Nates",
  subtitle = "Trabajo con lo que la tierra permite.",
  brand = "daniel",
} = Astro.props;
---

<style>
  .introGate{
    position:fixed;
    inset:0;
    z-index:9999;
    display:flex;
    align-items:center;
    justify-content:center;
    background: rgba(5,6,6,.92);
    backdrop-filter: blur(14px);
    transition: opacity .55s cubic-bezier(.22,1,.36,1),
                transform .55s cubic-bezier(.22,1,.36,1);
  }
  .introGate.hidden{
    opacity:0;
    pointer-events:none;
    transform: translateY(-6px);
  }

  .introCard{
    width:min(860px, 92vw);
    border-radius: 26px;
    border: 1px solid rgba(255,255,255,.12);
    background:
      radial-gradient(900px 420px at 18% 18%, var(--brand-soft), transparent 60%),
      radial-gradient(900px 480px at 86% 18%, rgba(160,120,220,.22), transparent 62%),
      rgba(255,255,255,.03);
    box-shadow: 0 30px 120px rgba(0,0,0,.7);
    overflow:hidden;
    padding: 22px 18px;
  }

  .introTop{
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
  }
  .introMark{
    display:flex;
    align-items:center;
    gap:10px;
    padding: 8px 12px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.03);
  }
  .dot{
    width:10px;height:10px;border-radius:999px;
    background: var(--brand-primary);
    box-shadow: 0 0 0 4px color-mix(in srgb, var(--brand-primary) 20%, transparent);
  }
  .markText{
    font-size:12px;
    letter-spacing:.18em;
    text-transform:uppercase;
    opacity:.9;
  }

  .skip{
    font-size:12px;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.03);
    cursor:pointer;
  }
  .skip:hover{ background: rgba(255,255,255,.06); }

  .introH{
    margin: 16px 0 8px;
    font-weight:650;
    font-size: clamp(30px, 5vw, 56px);
    line-height: 1.03;
    letter-spacing: -.03em;
  }
  .introP{
    margin:0;
    color: rgba(255,255,255,.75);
    font-size: 15px;
    line-height: 1.45;
    max-width: 60ch;
  }
  .bar{
    margin-top: 18px;
    height: 2px;
    background: rgba(255,255,255,.12);
    border-radius: 999px;
    overflow:hidden;
  }
  .bar > i{
    display:block;
    height:100%;
    width: 0%;
    background: color-mix(in srgb, var(--brand-primary) 70%, rgba(255,255,255,.35));
    animation: loadbar 1400ms cubic-bezier(.22,1,.36,1) forwards;
  }
  @keyframes loadbar { to { width:100%; } }
</style>

<div class="introGate hidden" data-intro data-intro-brand={brand}>
  <div class="introCard">
    <div class="introTop">
      <div class="introMark">
        <span class="dot"></span>
        <span class="markText">
          {brand === "olivea" ? "Olivea" : brand === "fritanguita" ? "Fritanguita" : "Daniel Nates"}
        </span>
      </div>
      <button class="skip" data-intro-skip>Skip</button>
    </div>

    <h1 class="introH">{title}</h1>
    <p class="introP">{subtitle}</p>

    <div class="bar" aria-hidden="true"><i></i></div>
  </div>
</div>

<script is:inline>
{`
(function(){
  function prefersReducedMotion(){
    try { return window.matchMedia('(prefers-reduced-motion: reduce)').matches; }
    catch { return false; }
  }

  function run(){
    const gates = Array.from(document.querySelectorAll('[data-intro]'));
    if (!gates.length) return;

    const url = new URL(window.location.href);
    const force = url.searchParams.get('intro') === '1';

    const key = 'dn_intro_seen_v6';
    const seen = (() => { try { return localStorage.getItem(key) === '1'; } catch { return true; } })();

    const shouldShow = !prefersReducedMotion() && (force || !seen);

    // If we shouldn't show, remove all intros immediately (no blocking)
    if (!shouldShow) {
      gates.forEach(g => g.remove());
      return;
    }

    // SHOW all intros (even if duplicates exist during transitions)
    gates.forEach((gate) => gate.classList.remove('hidden'));

    const hideAll = () => {
      try { localStorage.setItem(key,'1'); } catch {}
      gates.forEach((gate) => {
        gate.classList.add('hidden');
        gate.style.pointerEvents = 'none';
        setTimeout(() => { try { gate.remove(); } catch {} }, 700);
      });
    };

    // Wire skip for all
    gates.forEach((gate) => {
      const skip = gate.querySelector('[data-intro-skip]');
      if (skip) skip.addEventListener('click', hideAll, { once:true });
    });

    // Auto dismiss + hard failsafe
    setTimeout(hideAll, 1600);
    setTimeout(() => {
      // If anything remains, force remove
      document.querySelectorAll('[data-intro]').forEach((g) => g.remove());
    }, 4500);
  }

  // Run after load
  if (document.readyState === 'complete') run();
  else window.addEventListener('load', run, { once:true });

  // Run after Astro transitions
  document.addEventListener('astro:page-load', () => {
    // next tick ensures new DOM is present
    queueMicrotask(run);
  });
})();
`}
</script>