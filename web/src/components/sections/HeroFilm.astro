---
const {
  title,
  sub,
  pills = [],
  videoUrl = null,
  posterUrl = null,
  transitionKey = null
} = Astro.props;
---

<section id="inicio" class="hero">
  <div
    class="heroCard"
    transition:name={transitionKey ? `proj-${transitionKey}` : undefined}
  >
    <div class="heroMedia" aria-hidden="true">
      {posterUrl ? <img src={posterUrl} alt="" loading="eager" decoding="async" /> : null}

      {videoUrl ? (
        <video
          data-hero-video
          muted
          playsinline
          loop
          preload="metadata"
          poster={posterUrl ?? undefined}
        >
          <source src={videoUrl} />
        </video>
      ) : null}
    </div>

    <div class="heroScrim"></div>

    <div class="heroInner">
      <h1
        class="h1"
        transition:name={transitionKey ? `proj-title-${transitionKey}` : undefined}
      >
        {title}
      </h1>
      {sub ? <p class="sub">{sub}</p> : null}

      {pills?.length ? (
        <div class="heroMeta reveal-stagger">
          {pills.slice(0, 6).map((p) => (
            <span class="pill">{p?.label ?? "Pilar"}</span>
          ))}
        </div>
      ) : null}
    </div>
  </div>

  {/* Optional: safe autoplay/pause if video exists */}
  {videoUrl ? (
    <script is:inline>
      {`
        (function () {
          function prefersReducedMotion() {
            try { return window.matchMedia('(prefers-reduced-motion: reduce)').matches; }
            catch { return false; }
          }
          function saveDataOn() {
            try { return !!(navigator.connection && navigator.connection.saveData); }
            catch { return false; }
          }
          function boot() {
            if (prefersReducedMotion() || saveDataOn()) return;
            const v = document.querySelector('[data-hero-video]');
            if (!v) return;
            const io = new IntersectionObserver((entries) => {
              const e = entries[0];
              if (!e) return;
              if (e.isIntersecting) v.play().catch(() => {});
              else v.pause();
            }, { threshold: 0.4 });
            io.observe(v);
          }
          if (document.readyState === 'complete') boot();
          else window.addEventListener('load', boot, { once: true });
        })();
      `}
    </script>
  ) : null}
</section>