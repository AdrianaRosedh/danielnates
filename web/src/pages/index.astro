---
import BaseLayout from "../components/layout/BaseLayout.astro";
import TopDock from "../components/layout/TopDock.astro";
import HeroFilm from "../components/sections/HeroFilm.astro";
import ProjectsSection from "../components/sections/ProjectsSection.astro";
import FieldNotesSection from "../components/sections/FieldNotesSection.astro";
import ChapterProgress from "../components/motion/ChapterProgress.astro";

import MotionScripts from "../components/motion/MotionScripts.astro";

import { sanity } from "../lib/sanity";
import { DANIEL_QUERY, PROJECTS_QUERY, FIELD_NOTES_QUERY } from "../lib/queries";

const daniel = await sanity.fetch(DANIEL_QUERY);
const projects = await sanity.fetch(PROJECTS_QUERY);
const notes = await sanity.fetch(FIELD_NOTES_QUERY);

const safeProjects = Array.isArray(projects) ? projects : [];
const safeNotes = Array.isArray(notes) ? notes : [];

const heroTitle = daniel?.tagline?.es ?? daniel?.name ?? "Daniel Nates";
const heroSub = daniel?.subline?.es ?? null;
const pills = Array.isArray(daniel?.pillars) ? daniel.pillars : [];

const olivea = safeProjects.find((p) => p?.slug?.current === "olivea");
const frita = safeProjects.find((p) => p?.slug?.current === "fritanguita");
const maizal = safeProjects.find((p) => p?.slug?.current === "maizal");
---

<BaseLayout
  title={heroTitle}
  description="Daniel Nates — técnica global, territorio local. Ingrediente, fermentación, algas y eficiencia."
>

  <div class="shell">
    <TopDock
      items={[
        { label: "Inicio", href: "#inicio" },
        { label: "Olivea", href: "#olivea" },
        { label: "Fritanguita", href: "#fritanguita" },
        { label: "Field Notes", href: "#fieldnotes" },
      ]}
    />

    <div class="reveal">
      <HeroFilm
        title={heroTitle}
        sub={heroSub}
        videoUrl="/media/hero/hero.mp4"
      />
    </div>

    <section id="olivea" data-brand="olivea" class="section reveal">
      <p class="kicker">Olivea</p>
      <ProjectsSection projects={olivea ? [olivea] : []} />
    </section>

    <section id="fritanguita" data-brand="fritanguita" class="section reveal">
      <p class="kicker">Fritanguita</p>
      <ProjectsSection projects={frita ? [frita] : []} />
    </section>

    <section id="maizal" data-brand="maizal" class="section reveal">
      <p class="kicker">Maizal</p>
      <ProjectsSection projects={maizal ? [maizal] : []} />
    </section>

    <section id="fieldnotes" class="section reveal">
      <p class="kicker">Field Notes</p>
      <FieldNotesSection notes={safeNotes} />
    </section>
  </div>

  <ChapterProgress />
  <MotionScripts />
</BaseLayout>