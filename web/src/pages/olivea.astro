---
import BaseLayout from "../components/layout/BaseLayout.astro";
import TopDock from "../components/layout/TopDock.astro";
import HeroFilm from "../components/sections/HeroFilm.astro";
import PortableText from "../components/content/PortableText.astro";
import ChapterProgress from "../components/motion/ChapterProgress.astro";

import MotionScripts from "../components/motion/MotionScripts.astro";
import IntroGate from "../components/motion/IntroGate.astro";

import { sanity } from "../lib/sanity";
import { PROJECT_BY_SLUG } from "../lib/queries";

const project = await sanity.fetch(PROJECT_BY_SLUG, { slug: "olivea" });

const title = project?.title ?? "Olivea";
const summary = project?.summary?.es ?? "";
---

<BaseLayout title={title} description={summary}>
  <IntroGate title="Olivea" subtitle={summary || "Proyecto central"} brand="olivea" />

  <div class="shell" data-brand="olivea">
    <TopDock
      items={[
        { label: "Inicio", href: "/" },
        { label: "Proyectos", href: "/#proyectos" },
        { label: "Fritanguita", href: "/fritanguita" },
      ]}
    />

    <div class="reveal">
      <HeroFilm
        title={title}
        sub={summary}
        pills={[{ label: "Proyecto central" }, { label: "Territorio" }, { label: "Técnica" }]}
        videoUrl={project?.heroMedia?.videoUrl ?? null}
        posterUrl={null}
        transitionKey="olivea"
      />
    </div>

    <section class="section reveal">
      <p class="kicker">Capítulo</p>

      <div class="projectCard" style="flex-direction:column;gap:12px;">
        {project?.body?.es ? (
          <PortableText value={project.body.es} />
        ) : (
          <p class="projectText">Agrega texto largo en Sanity → Cuerpo (editorial) → ES.</p>
        )}

        {project?.links?.length ? (
          <div class="badges reveal-stagger">
            {project.links.map((l) => (
              <a class="cta" href={l.href} target="_blank" rel="noreferrer">{l.label}</a>
            ))}
          </div>
        ) : null}
      </div>
    </section>
  </div>

  <ChapterProgress />
  <MotionScripts />
</BaseLayout>